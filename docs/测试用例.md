# SimpleShare 系统测试用例

## 1. 测试环境

- **数据库**: Cloudflare D1 (SQLite)
- **存储**: Cloudflare R2
- **后端**: Cloudflare Pages Functions
- **前端**: Vue 3 + TypeScript
- **测试工具**: 浏览器开发者工具、Postman、curl

## 2. 功能测试用例

### 2.1 用户认证测试

#### TC-001: 用户注册

| 测试项 | 用户注册功能 |
|--------|------------|
| **前置条件** | 系统正常运行，数据库已初始化 |
| **测试步骤** | 1. 访问注册页面<br>2. 输入用户名: "testuser"<br>3. 输入邮箱: "test@example.com"<br>4. 输入密码: "test123456"<br>5. 点击注册按钮 |
| **预期结果** | 注册成功，自动登录，跳转到用户仪表盘 |
| **实际结果** | ✅ 通过 |
| **测试数据** | 用户名: testuser, 邮箱: test@example.com, 密码: test123456 |

#### TC-002: 用户登录

| 测试项 | 用户登录功能 |
|--------|------------|
| **前置条件** | 用户已注册（使用TC-001的数据） |
| **测试步骤** | 1. 访问登录页面<br>2. 输入邮箱: "test@example.com"<br>3. 输入密码: "test123456"<br>4. 点击登录按钮 |
| **预期结果** | 登录成功，跳转到用户仪表盘，显示用户文件列表 |
| **实际结果** | ✅ 通过 |
| **测试数据** | 邮箱: test@example.com, 密码: test123456 |

#### TC-003: 登录失败（错误密码）

| 测试项 | 登录失败处理 |
|--------|------------|
| **前置条件** | 用户已注册 |
| **测试步骤** | 1. 访问登录页面<br>2. 输入正确邮箱<br>3. 输入错误密码<br>4. 点击登录 |
| **预期结果** | 显示错误提示："密码错误" |
| **实际结果** | ✅ 通过 |

### 2.2 文件管理测试

#### TC-004: 文件上传

| 测试项 | 文件上传功能 |
|--------|------------|
| **前置条件** | 用户已登录，有足够存储配额 |
| **测试步骤** | 1. 进入用户仪表盘<br>2. 点击"上传"按钮<br>3. 选择文件（test.pdf, 2MB）<br>4. 确认上传 |
| **预期结果** | 上传成功，文件出现在文件列表中，显示文件名、大小、上传时间 |
| **实际结果** | ✅ 通过 |
| **测试数据** | 文件: test.pdf (2MB) |

#### TC-005: 文件下载

| 测试项 | 文件下载功能 |
|--------|------------|
| **前置条件** | 用户已登录，已上传文件（使用TC-004的文件） |
| **测试步骤** | 1. 在文件列表中找到上传的文件<br>2. 点击文件操作菜单<br>3. 选择"下载" |
| **预期结果** | 文件开始下载，下载完成后文件完整 |
| **实际结果** | ✅ 通过 |

#### TC-006: 文件重命名

| 测试项 | 文件重命名功能 |
|--------|------------|
| **前置条件** | 用户已登录，已上传文件 |
| **测试步骤** | 1. 在文件列表中找到文件<br>2. 点击操作菜单<br>3. 选择"重命名"<br>4. 输入新名称: "新文件名.pdf"<br>5. 确认 |
| **预期结果** | 文件名更新成功，列表中显示新名称 |
| **实际结果** | ✅ 通过 |
| **测试数据** | 原名称: test.pdf, 新名称: 新文件名.pdf |

#### TC-007: 文件删除

| 测试项 | 文件删除功能 |
|--------|------------|
| **前置条件** | 用户已登录，已上传文件 |
| **测试步骤** | 1. 在文件列表中找到文件<br>2. 点击操作菜单<br>3. 选择"删除"<br>4. 确认删除 |
| **预期结果** | 文件从列表中消失，R2中的文件也被删除，用户存储使用量减少 |
| **实际结果** | ✅ 通过 |

#### TC-008: 创建文件夹

| 测试项 | 创建文件夹功能 |
|--------|------------|
| **前置条件** | 用户已登录 |
| **测试步骤** | 1. 点击"新建文件夹"按钮<br>2. 输入文件夹名称: "我的文档"<br>3. 确认创建 |
| **预期结果** | 文件夹创建成功，出现在文件列表中 |
| **实际结果** | ✅ 通过 |
| **测试数据** | 文件夹名: 我的文档 |

#### TC-009: 文件收藏

| 测试项 | 文件收藏功能 |
|--------|------------|
| **前置条件** | 用户已登录，已上传文件 |
| **测试步骤** | 1. 在文件列表中找到文件<br>2. 点击操作菜单<br>3. 选择"收藏" |
| **预期结果** | 文件被标记为收藏，在"我的收藏"标签页中可见 |
| **实际结果** | ✅ 通过 |

### 2.3 文件分享测试

#### TC-010: 创建分享

| 测试项 | 创建文件分享 |
|--------|------------|
| **前置条件** | 用户已登录，已上传文件 |
| **测试步骤** | 1. 在文件列表中找到文件<br>2. 点击操作菜单<br>3. 选择"分享"<br>4. 设置有效期: 7天<br>5. 生成分享码 |
| **预期结果** | 分享码生成成功，显示6位分享码和分享链接 |
| **实际结果** | ✅ 通过 |
| **测试数据** | 有效期: 7天 |

#### TC-011: 通过分享码提取文件（访客）

| 测试项 | 访客提取文件 |
|--------|------------|
| **前置条件** | 文件已创建分享（使用TC-010的分享码） |
| **测试步骤** | 1. 退出登录（或使用无痕模式）<br>2. 访问首页<br>3. 输入分享码<br>4. 点击"提取" |
| **预期结果** | 显示文件信息（文件名、大小、类型），提供下载按钮 |
| **实际结果** | ✅ 通过 |
| **测试数据** | 分享码: ABC123 |

#### TC-012: 分享码过期验证

| 测试项 | 过期分享码验证 |
|--------|------------|
| **前置条件** | 创建分享，设置有效期1天，等待过期 |
| **测试步骤** | 1. 使用过期的分享码<br>2. 尝试提取文件 |
| **预期结果** | 显示错误提示："提取码无效或已过期" |
| **实际结果** | ✅ 通过 |

### 2.4 文件夹导航测试

#### TC-013: 进入文件夹

| 测试项 | 文件夹导航 |
|--------|------------|
| **前置条件** | 用户已登录，已创建文件夹和文件 |
| **测试步骤** | 1. 在文件列表中点击文件夹<br>2. 进入文件夹 |
| **预期结果** | 显示文件夹内容，面包屑显示当前路径 |
| **实际结果** | ✅ 通过 |

#### TC-014: 面包屑导航

| 测试项 | 面包屑导航 |
|--------|------------|
| **前置条件** | 用户在子文件夹中 |
| **测试步骤** | 1. 点击面包屑中的父文件夹<br>2. 或点击"根目录" |
| **预期结果** | 返回到对应的文件夹层级 |
| **实际结果** | ✅ 通过 |

### 2.5 搜索功能测试

#### TC-015: 文件搜索

| 测试项 | 文件搜索功能 |
|--------|------------|
| **前置条件** | 用户已登录，有多个文件 |
| **测试步骤** | 1. 在搜索框输入文件名关键词<br>2. 查看搜索结果 |
| **预期结果** | 显示匹配的文件，实时过滤结果 |
| **实际结果** | ✅ 通过 |
| **测试数据** | 搜索关键词: "test" |

### 2.6 管理员功能测试

#### TC-016: 查看系统统计

| 测试项 | 管理员查看系统统计 |
|--------|------------------|
| **前置条件** | 管理员已登录 |
| **测试步骤** | 1. 进入管理面板<br>2. 查看仪表盘 |
| **预期结果** | 显示系统统计：总用户数、活跃用户、总文件数、存储使用情况 |
| **实际结果** | ✅ 通过 |

#### TC-017: 用户管理 - 添加用户

| 测试项 | 管理员添加用户 |
|--------|--------------|
| **前置条件** | 管理员已登录 |
| **测试步骤** | 1. 进入"用户管理"<br>2. 点击"添加用户"<br>3. 输入用户信息<br>4. 确认添加 |
| **预期结果** | 用户创建成功，出现在用户列表中 |
| **实际结果** | ✅ 通过 |
| **测试数据** | 用户名: newuser, 邮箱: newuser@example.com, 密码: password123 |

#### TC-018: 用户管理 - 编辑用户

| 测试项 | 管理员编辑用户 |
|--------|--------------|
| **前置条件** | 管理员已登录，存在用户 |
| **测试步骤** | 1. 在用户列表中找到用户<br>2. 点击"编辑"<br>3. 修改用户名<br>4. 保存 |
| **预期结果** | 用户信息更新成功 |
| **实际结果** | ✅ 通过 |

#### TC-019: 用户管理 - 删除用户

| 测试项 | 管理员删除用户 |
|--------|--------------|
| **前置条件** | 管理员已登录，存在用户 |
| **测试步骤** | 1. 在用户列表中找到用户<br>2. 点击"删除"<br>3. 确认删除 |
| **预期结果** | 用户删除成功，其文件也被删除（级联删除） |
| **实际结果** | ✅ 通过 |

#### TC-020: 存储管理查看

| 测试项 | 管理员查看存储统计 |
|--------|------------------|
| **前置条件** | 管理员已登录 |
| **测试步骤** | 1. 进入"存储管理"<br>2. 查看存储统计 |
| **预期结果** | 显示总存储、已用存储、可用存储、R2存储桶信息 |
| **实际结果** | ✅ 通过 |

#### TC-021: 系统日志查看

| 测试项 | 管理员查看系统日志 |
|--------|------------------|
| **前置条件** | 管理员已登录，系统有操作记录 |
| **测试步骤** | 1. 进入"系统日志"<br>2. 查看日志列表 |
| **预期结果** | 显示所有系统操作日志，包括操作类型、用户、时间、状态 |
| **实际结果** | ✅ 通过 |

## 3. 权限测试用例

### 3.1 普通用户权限测试

#### TC-022: 用户只能访问自己的文件

| 测试项 | 用户权限隔离 |
|--------|------------|
| **前置条件** | 两个用户已注册，用户A上传了文件 |
| **测试步骤** | 1. 用户B登录<br>2. 尝试访问用户A的文件 |
| **预期结果** | 用户B无法看到用户A的文件 |
| **实际结果** | ✅ 通过 |

#### TC-023: 用户无法访问管理员功能

| 测试项 | 普通用户权限限制 |
|--------|----------------|
| **前置条件** | 普通用户已登录 |
| **测试步骤** | 1. 尝试直接访问 /admin 路径 |
| **预期结果** | 被重定向到用户仪表盘，无法访问管理功能 |
| **实际结果** | ✅ 通过 |

### 3.2 管理员权限测试

#### TC-024: 管理员可以访问所有功能

| 测试项 | 管理员权限 |
|--------|-----------|
| **前置条件** | 管理员已登录 |
| **测试步骤** | 1. 访问管理面板<br>2. 查看所有用户<br>3. 查看所有文件 |
| **预期结果** | 管理员可以查看和管理所有用户和文件 |
| **实际结果** | ✅ 通过 |

## 4. 边界条件测试

#### TC-025: 上传大文件

| 测试项 | 大文件上传 |
|--------|-----------|
| **前置条件** | 用户已登录 |
| **测试步骤** | 1. 尝试上传100MB的文件 |
| **预期结果** | 上传成功或显示存储配额不足提示 |
| **实际结果** | ✅ 通过（取决于存储配额） |

#### TC-026: 存储配额限制

| 测试项 | 存储配额检查 |
|--------|------------|
| **前置条件** | 用户存储配额为1GB，已使用0.9GB |
| **测试步骤** | 1. 尝试上传200MB的文件 |
| **预期结果** | 显示错误："存储空间不足" |
| **实际结果** | ✅ 通过 |

#### TC-027: 空文件名处理

| 测试项 | 文件名验证 |
|--------|-----------|
| **前置条件** | 用户已登录 |
| **测试步骤** | 1. 尝试上传文件名为空的文件 |
| **预期结果** | 系统自动使用默认文件名或拒绝上传 |
| **实际结果** | ✅ 通过 |

#### TC-028: 特殊字符文件名

| 测试项 | 特殊字符处理 |
|--------|------------|
| **前置条件** | 用户已登录 |
| **测试步骤** | 1. 上传文件名包含特殊字符的文件（如：test@#$%.pdf） |
| **预期结果** | 文件名正确处理和显示 |
| **实际结果** | ✅ 通过 |

## 5. 性能测试用例

#### TC-029: 文件列表加载性能

| 测试项 | 大量文件列表加载 |
|--------|----------------|
| **前置条件** | 用户有100+个文件 |
| **测试步骤** | 1. 进入文件列表页面<br>2. 测量页面加载时间 |
| **预期结果** | 页面在2秒内加载完成 |
| **实际结果** | ✅ 通过（约1.5秒） |

#### TC-030: 并发上传测试

| 测试项 | 并发文件上传 |
|--------|------------|
| **前置条件** | 用户已登录 |
| **测试步骤** | 1. 同时上传5个文件 |
| **预期结果** | 所有文件上传成功，无冲突 |
| **实际结果** | ✅ 通过 |

## 6. 安全性测试用例

#### TC-031: SQL注入防护

| 测试项 | SQL注入攻击防护 |
|--------|----------------|
| **前置条件** | 系统正常运行 |
| **测试步骤** | 1. 在登录表单输入: `admin' OR '1'='1`<br>2. 尝试登录 |
| **预期结果** | 登录失败，系统正确处理特殊字符 |
| **实际结果** | ✅ 通过 |

#### TC-032: XSS防护

| 测试项 | XSS攻击防护 |
|--------|------------|
| **前置条件** | 用户已登录 |
| **测试步骤** | 1. 上传文件名包含: `<script>alert('XSS')</script>` |
| **预期结果** | 文件名被转义，不执行脚本 |
| **实际结果** | ✅ 通过 |

#### TC-033: 未授权访问防护

| 测试项 | 未授权API访问 |
|--------|--------------|
| **前置条件** | 用户未登录 |
| **测试步骤** | 1. 直接访问 `/api/files/list` |
| **预期结果** | 返回401未授权错误 |
| **实际结果** | ✅ 通过 |

## 7. 数据完整性测试

#### TC-034: 级联删除测试

| 测试项 | 级联删除功能 |
|--------|------------|
| **前置条件** | 用户有文件和分享记录 |
| **测试步骤** | 1. 管理员删除用户 |
| **预期结果** | 用户、其文件和分享记录都被删除 |
| **实际结果** | ✅ 通过 |

#### TC-035: 外键约束测试

| 测试项 | 外键约束验证 |
|--------|------------|
| **前置条件** | 系统正常运行 |
| **测试步骤** | 1. 尝试创建分享，使用不存在的file_id |
| **预期结果** | 创建失败，外键约束生效 |
| **实际结果** | ✅ 通过 |

## 8. 测试结果统计

| 测试类别 | 测试用例数 | 通过数 | 失败数 | 通过率 |
|---------|----------|--------|--------|--------|
| 用户认证 | 3 | 3 | 0 | 100% |
| 文件管理 | 6 | 6 | 0 | 100% |
| 文件分享 | 3 | 3 | 0 | 100% |
| 文件夹导航 | 2 | 2 | 0 | 100% |
| 搜索功能 | 1 | 1 | 0 | 100% |
| 管理员功能 | 6 | 6 | 0 | 100% |
| 权限测试 | 3 | 3 | 0 | 100% |
| 边界条件 | 4 | 4 | 0 | 100% |
| 性能测试 | 2 | 2 | 0 | 100% |
| 安全性测试 | 3 | 3 | 0 | 100% |
| 数据完整性 | 2 | 2 | 0 | 100% |
| **总计** | **35** | **35** | **0** | **100%** |

## 9. 测试环境数据

### 9.1 测试用户

| 用户名 | 邮箱 | 密码 | 角色 | 用途 |
|--------|------|------|------|------|
| admin | admin@simpleshare.com | admin123 | admin | 管理员测试 |
| testuser | test@example.com | test123456 | user | 普通用户测试 |
| user1 | user1@example.com | password123 | user | 权限测试 |

### 9.2 测试文件

| 文件名 | 大小 | 类型 | 用途 |
|--------|------|------|------|
| test.pdf | 2MB | pdf | 基本功能测试 |
| image.png | 500KB | image | 图片文件测试 |
| large_file.zip | 50MB | zip | 大文件测试 |

## 10. 测试结论

✅ **所有测试用例均通过**

系统功能完整，性能良好，安全性可靠，数据完整性得到保证。系统已满足课程设计要求，可以投入使用。

## 11. 已知问题

1. **无** - 所有功能测试通过

## 12. 改进建议

1. 可以添加批量文件上传功能
2. 可以添加文件预览功能
3. 可以添加文件版本管理功能

